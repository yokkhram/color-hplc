<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🎨 Real-time Color Sensor</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", sans-serif;
      background-color: #0d1117;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      height: 100vh;
      overflow: hidden;
    }

    h1 { margin-top: 8px; font-size: 1.3rem; }

    .color-box {
      width: 220px;
      height: 80px;
      border-radius: 10px;
      border: 2px solid #444;
      transition: background 0.3s ease;
    }

    .hex-code { margin: 6px 0; color: #aaa; }

    canvas {
      width: 85%;
      max-width: 600px;
      height: 45%;
      border-radius: 10px;
      background-color: #161b22;
    }

    button {
      background-color: #238636;
      border: none;
      color: white;
      border-radius: 8px;
      padding: 10px 20px;
      margin-bottom: 10px;
      cursor: pointer;
    }

    button:hover { background-color: #2ea043; }
  </style>
</head>

<body>
  <h1>🎨 Real-time Color Sensor</h1>

  <div class="color-box" id="colorBox"></div>
  <div class="hex-code" id="hexText">#000000</div>

  <canvas id="chart"></canvas>
  <button onclick="resetChart()">🔄 Reset</button>

  <script>
    const ctx = document.getElementById("chart").getContext("2d");
    const chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: [],
        datasets: [
          { label: "Red", borderColor: "red", data: [] },
          { label: "Green", borderColor: "lime", data: [] },
          { label: "Blue", borderColor: "blue", data: [] },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: false,
        scales: {
          y: { beginAtZero: true, max: 255, ticks: { color: "#aaa" }, grid: { color: "#333" } },
          x: { ticks: { color: "#aaa" }, grid: { color: "#333" } },
        },
        plugins: { legend: { labels: { color: "#fff" } } },
      },
    });

    function updateUI(r, g, b, hex) {
      const box = document.getElementById("colorBox");
      const text = document.getElementById("hexText");
      box.style.backgroundColor = `rgb(${r},${g},${b})`;
      text.textContent = hex;
    }

    function addData(r, g, b) {
      const t = new Date().toLocaleTimeString();
      chart.data.labels.push(t);
      chart.data.datasets[0].data.push(r);
      chart.data.datasets[1].data.push(g);
      chart.data.datasets[2].data.push(b);

      if (chart.data.labels.length > 30) {
        chart.data.labels.shift();
        chart.data.datasets.forEach(ds => ds.data.shift());
      }
      chart.update();
    }

    async function fetchData() {
      try {
        const res = await fetch("https://color-hplc.onrender.com/latest");
        const data = await res.json();
        addData(data.r, data.g, data.b);
        updateUI(data.r, data.g, data.b, data.hex);
      } catch (err) {
        console.log("⚠️ Fetch error:", err);
      }
    }

    function resetChart() {
      chart.data.labels = [];
      chart.data.datasets.forEach(ds => ds.data = []);
      chart.update();
      updateUI(0, 0, 0, "#000000");
    }

    setInterval(fetchData, 1000);
  </script>
</body>
</html>
